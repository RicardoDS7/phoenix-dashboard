(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[542],{477:()=>{},3843:(e,t,a)=>{"use strict";a.d(t,{db:()=>i});var l=a(3915),s=a(5317);let r=(0,l.Wp)({apiKey:"AIzaSyDKxm2rzvjgsxfg1vJ6ZgzPJRPfY3R7HR4",authDomain:"phoenix-energy-firebase.firebaseapp.com",projectId:"phoenix-energy-firebase",storageBucket:"phoenix-energy-firebase.firebasestorage.app",messagingSenderId:"82665667347",appId:"1:82665667347:web:a6dab9227aa655573638e6",measurementId:"G-1CQS4L7V4Y"}),i=(0,s.aU)(r)},5228:(e,t,a)=>{Promise.resolve().then(a.bind(a,9306))},9306:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var l=a(5155),s=a(2115),r=a(5317),i=a(3843),n=a(2515),c=a(5695),o=a(1883);let d=o.vv.create({page:{padding:30,fontSize:10,fontFamily:"Helvetica"},section:{marginBottom:10},row:{flexDirection:"row",borderBottom:1,borderBottomColor:"#ccc"},cell:{padding:5},description:{flex:3},qty:{flex:.8},unitPrice:{flex:1.2},total:{flex:1.2},bold:{fontWeight:"bold"},totalText:{textAlign:"right",marginTop:10,fontSize:12}}),u=e=>{let t="string"==typeof e?parseFloat(e):e;return isNaN(t)?"0.00":t.toLocaleString("en-ZA",{minimumFractionDigits:2,maximumFractionDigits:2})},m=e=>{let{data:t}=e,{quoteDetails:a}=t;return(0,l.jsx)(o.yo,{children:(0,l.jsxs)(o.YW,{size:"A4",style:d.page,children:[(0,l.jsx)(o.EY,{style:{fontSize:16,marginBottom:10},children:"Quote Summary"}),(0,l.jsxs)(o.Ss,{style:d.section,children:[(0,l.jsxs)(o.EY,{children:["Client: ",a.selectedCustomer]}),(0,l.jsxs)(o.EY,{children:["Solar Capacity: ",a.solarCapacity," kWp"]}),(0,l.jsxs)(o.EY,{children:["Battery Capacity: ",a.batteryCapacity," kWh"]}),(0,l.jsxs)(o.EY,{children:["Panel QTY: ",a.panelQTY]})]}),(0,l.jsxs)(o.Ss,{style:[d.row,d.bold],children:[(0,l.jsx)(o.EY,{style:[d.cell,d.description],children:"Description"}),(0,l.jsx)(o.EY,{style:[d.cell,d.qty],children:"Qty"}),(0,l.jsx)(o.EY,{style:[d.cell,d.unitPrice],children:"Unit Price"}),(0,l.jsx)(o.EY,{style:[d.cell,d.total],children:"Total"})]}),a.lineItems.map((e,t)=>(0,l.jsxs)(o.Ss,{style:d.row,children:[(0,l.jsx)(o.EY,{style:[d.cell,d.description],children:e.description}),(0,l.jsx)(o.EY,{style:[d.cell,d.qty],children:e.qty}),(0,l.jsxs)(o.EY,{style:[d.cell,d.unitPrice],children:["$ ",u(e.unit)]}),(0,l.jsxs)(o.EY,{style:[d.cell,d.total],children:["$ ",u(e.total)]})]},t)),(0,l.jsxs)(o.EY,{style:d.totalText,children:["Overall Total: $ ",u(a.overallTotal)," excl. VAT"]})]})})};function p(){let e=(0,c.useRouter)(),[t,a]=(0,s.useState)([]),[d,u]=(0,s.useState)(""),[p,x]=(0,s.useState)([]),[y,h]=(0,s.useState)(""),[g,b]=(0,s.useState)(null),[j,f]=(0,s.useState)([{description:"",qty:"",unit:"",margin:"0",total:"0",category:"shared"}]),[N,v]=(0,s.useState)({solarCapacity:"",panelQTY:"",batteryCapacity:""});(0,s.useEffect)(()=>{(async function(){try{let e=(await (0,r.GG)((0,r.rJ)(i.db,"clients"))).docs.map(e=>{var t;let a=e.data();return{id:e.id,name:null!==(t=a.name)&&void 0!==t?t:e.id}});a(e)}catch(e){console.error("Error fetching clients:",e)}})()},[]),(0,s.useEffect)(()=>{d&&e();async function e(){x((await (0,r.GG)((0,r.rJ)(i.db,"clients",d,"quotes"))).docs.map(e=>({id:e.id}))),h(""),b(null)}},[d]),(0,s.useEffect)(()=>{d&&y&&e();async function e(){try{let e=(0,r.H9)(i.db,"clients",d,"quotes",y),t=await (0,r.x7)(e);if(t.exists()){let e=t.data();b(e),f(e.quoteDetails.lineItems),v({solarCapacity:e.quoteDetails.solarCapacity,panelQTY:e.quoteDetails.panelQTY,batteryCapacity:e.quoteDetails.batteryCapacity})}}catch(e){console.error("Error fetching quote:",e)}}},[d,y]);let w=(e,t,a)=>{let l=[...j];if(l[e]={...l[e],[t]:a},"qty"===t||"unit"===t||"margin"===t){let t=Number(l[e].qty),a=Number(l[e].unit),s=Number(l[e].margin)/100;l[e].total=isNaN(t)||isNaN(a)||isNaN(s)?"0":(t*a*(1+s)).toString()}f(l)},C=e=>{j.length>1?f(t=>t.filter((t,a)=>a!==e)):alert("At least one line item is required.")},S=j.reduce((e,t)=>e+Number(t.qty)*Number(t.unit),0),q=j.reduce((e,t)=>e+Number(t.total),0),E=q-S,Y=S>0?E/S*100:0,k=e=>{let{name:t,value:a}=e.target;v(e=>({...e,[t]:a}))},D=async e=>{if(e.preventDefault(),!d||!y){alert("Select client and quote");return}try{await (0,r.BN)((0,r.H9)(i.db,"clients",d,"quotes",y),{quoteDetails:{selectedCustomer:d,lineItems:j,overallTotal:q,profit:E,marginPercentage:Y,...N},updatedAt:new Date},{merge:!0}),alert("Quote updated successfully!")}catch(e){console.error("Error updating quote:",e),alert("Error updating quote. See console.")}};return(0,l.jsxs)("div",{className:"min-h-screen p-4 flex flex-col items-center",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold mb-8 print-hidden",children:"Edit Quote"}),(0,l.jsxs)("div",{className:"w-full max-w-4xl space-y-6 mb-8",children:[(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Select Client"}),(0,l.jsxs)("select",{value:d,onChange:e=>u(e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md",children:[(0,l.jsx)("option",{value:"",children:"Select a client"}),t.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),d&&(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Select Quote"}),(0,l.jsxs)("select",{value:y,onChange:e=>h(e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md",children:[(0,l.jsx)("option",{value:"",children:"Select a quote"}),p.map(e=>(0,l.jsx)("option",{value:e.id,children:e.id},e.id))]})]})]}),g&&(0,l.jsxs)(l.Fragment,{children:[g?(0,l.jsx)(o.XP,{document:(0,l.jsx)(m,{data:g}),fileName:"Quote-".concat(y,".pdf"),className:"print-hidden bg-blue-600 text-white py-2 px-4 rounded-full mt-4",children:e=>{let{loading:t}=e;return t?"Generating PDF...":"Export as PDF"}}):null,(0,l.jsxs)("form",{onSubmit:D,className:"w-full max-w-6xl space-y-6",id:"printable",children:[(0,l.jsx)("div",{className:"grid grid-cols-3 gap-6",children:[{label:"Solar Capacity (kWp)",name:"solarCapacity"},{label:"Panel QTY",name:"panelQTY"},{label:"Battery Capacity (kWh)",name:"batteryCapacity"}].map(e=>{let{label:t,name:a}=e;return(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("span",{className:"text-gray-700",children:t}),(0,l.jsx)("input",{type:"text",name:a,value:N[a],onChange:k,className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300"})]},a)})}),(0,l.jsxs)("div",{className:"space-y-4 mt-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold",children:"Line Items"}),j.map((e,t)=>(0,l.jsxs)("div",{className:"flex gap-2 border p-4 rounded-lg items-center",children:[(0,l.jsx)("p",{className:"font-bold",children:t+1}),(0,l.jsxs)("label",{className:"block w-full",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Description"}),(0,l.jsx)("input",{type:"text",value:e.description,onChange:e=>w(t,"description",e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300",required:!0})]}),(0,l.jsxs)("label",{className:"block w-1/3 print-hidden",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Allocation"}),(0,l.jsxs)("select",{value:e.category,onChange:e=>w(t,"category",e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300",children:[(0,l.jsx)("option",{value:"shared",children:"Shared"}),(0,l.jsx)("option",{value:"solar",children:"Solar"}),(0,l.jsx)("option",{value:"battery",children:"Battery"})]})]}),(0,l.jsxs)("label",{className:"block w-1/3",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Quantity"}),(0,l.jsx)("input",{type:"number",value:e.qty,onChange:e=>w(t,"qty",e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300",required:!0})]}),(0,l.jsxs)("label",{className:"block w-1/2 print-hidden",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Unit Price"}),(0,l.jsx)("input",{type:"number",value:e.unit,onChange:e=>w(t,"unit",e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300",required:!0})]}),(0,l.jsxs)("label",{className:"block w-1/4 print-hidden",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Markup %"}),(0,l.jsx)("input",{type:"number",value:e.margin,onChange:e=>w(t,"margin",e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300",required:!0})]}),(0,l.jsxs)("label",{className:"block w-1/2",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Total"}),(0,l.jsx)("input",{readOnly:!0,value:Number(e.total).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300"})]}),(0,l.jsx)("button",{type:"button",onClick:()=>C(t),className:"mt-2 text-red-600 print-hidden",children:(0,l.jsx)(n.b6i,{size:25})})]},t)),(0,l.jsx)("button",{type:"button",onClick:()=>f(e=>[...e,{description:"",qty:"",unit:"",margin:"0",total:"0",category:"shared"}]),className:"bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-full print-hidden",children:"Add Line Item"})]}),(0,l.jsxs)("div",{className:"text-right font-bold text-xl",children:["Overall Total: R ",q.toFixed(2)]}),(0,l.jsxs)("div",{className:"text-right font-bold text-md",children:["Total Profit: R ",E.toFixed(2)]}),(0,l.jsxs)("div",{className:"text-right font-bold text-md",children:["Profit Margin: ",Y.toFixed(2),"%"]}),(0,l.jsx)("button",{type:"submit",className:"mt-8 bg-[#4c7380] hover:bg-[#FFA07A] text-white font-bold py-2 px-4 rounded-full print-hidden",children:"Save Changes"})]})]}),(0,l.jsx)("button",{onClick:()=>e.push("/"),className:"mt-8 bg-[#4c7380] hover:bg-[#FFA07A] text-white font-bold py-2 px-4 rounded-full print-hidden",children:"Return Home"})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,479,247,788,746,792,399,233,441,684,358],()=>t(5228)),_N_E=e.O()}]);