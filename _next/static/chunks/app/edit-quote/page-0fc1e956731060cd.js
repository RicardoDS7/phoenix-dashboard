(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[542],{435:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>o});var l=t(5155),s=t(2115),r=t(5317),n=t(3843),i=t(2515),d=t(5695);let c=(0,t(5028).default)(()=>Promise.all([t.e(247),t.e(788),t.e(746),t.e(792),t.e(172),t.e(588)]).then(t.bind(t,5592)),{loadableGenerated:{webpack:()=>[5592]},ssr:!1});function o(){let e=(0,d.useRouter)(),[a,t]=(0,s.useState)([]),[o,u]=(0,s.useState)(""),[m,p]=(0,s.useState)([]),[x,g]=(0,s.useState)(""),[b,h]=(0,s.useState)(null),[y,N]=(0,s.useState)([{description:"",qty:"",unit:"",margin:"0",total:"0",category:"shared"}]),[f,j]=(0,s.useState)({solarCapacity:"",panelQTY:"",batteryCapacity:""});(0,s.useEffect)(()=>{(async function(){try{let e=(await (0,r.GG)((0,r.rJ)(n.db,"clients"))).docs.map(e=>{var a;let t=e.data();return{id:e.id,name:null!==(a=t.name)&&void 0!==a?a:e.id}});t(e)}catch(e){console.error("Error fetching clients:",e)}})()},[]),(0,s.useEffect)(()=>{o&&e();async function e(){p((await (0,r.GG)((0,r.rJ)(n.db,"clients",o,"quotes"))).docs.map(e=>({id:e.id}))),g(""),h(null)}},[o]),(0,s.useEffect)(()=>{o&&x&&e();async function e(){try{let e=(0,r.H9)(n.db,"clients",o,"quotes",x),a=await (0,r.x7)(e);if(a.exists()){let e=a.data();h(e),N(e.quoteDetails.lineItems),j({solarCapacity:e.quoteDetails.solarCapacity,panelQTY:e.quoteDetails.panelQTY,batteryCapacity:e.quoteDetails.batteryCapacity})}}catch(e){console.error("Error fetching quote:",e)}}},[o,x]);let v=(e,a,t)=>{let l=[...y];if(l[e]={...l[e],[a]:t},"qty"===a||"unit"===a||"margin"===a){let a=Number(l[e].qty),t=Number(l[e].unit),s=Number(l[e].margin)/100;l[e].total=isNaN(a)||isNaN(t)||isNaN(s)?"0":(a*t*(1+s)).toString()}N(l)},w=e=>{y.length>1?N(a=>a.filter((a,t)=>t!==e)):alert("At least one line item is required.")},C=y.reduce((e,a)=>e+Number(a.qty)*Number(a.unit),0),q=y.reduce((e,a)=>e+Number(a.total),0),S=q-C,k=C>0?S/C*100:0,D=e=>{let{name:a,value:t}=e.target;j(e=>({...e,[a]:t}))},E=async e=>{if(e.preventDefault(),!o||!x){alert("Select client and quote");return}try{await (0,r.BN)((0,r.H9)(n.db,"clients",o,"quotes",x),{quoteDetails:{selectedCustomer:o,lineItems:y,overallTotal:q,profit:S,marginPercentage:k,...f},updatedAt:new Date},{merge:!0}),alert("Quote updated successfully!")}catch(e){console.error("Error updating quote:",e),alert("Error updating quote. See console.")}};return(0,l.jsxs)("div",{className:"min-h-screen p-4 flex flex-col items-center",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold mb-8 print-hidden",children:"Edit Quote"}),(0,l.jsxs)("div",{className:"w-full max-w-4xl space-y-6 mb-8",children:[(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Select Client"}),(0,l.jsxs)("select",{value:o,onChange:e=>u(e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md",children:[(0,l.jsx)("option",{value:"",children:"Select a client"}),a.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),o&&(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Select Quote"}),(0,l.jsxs)("select",{value:x,onChange:e=>g(e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md",children:[(0,l.jsx)("option",{value:"",children:"Select a quote"}),m.map(e=>(0,l.jsx)("option",{value:e.id,children:e.id},e.id))]})]})]}),b&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c,{data:b,selectedQuote:x}),(0,l.jsxs)("form",{onSubmit:E,className:"w-full max-w-6xl space-y-6",id:"printable",children:[(0,l.jsx)("div",{className:"grid grid-cols-3 gap-6",children:[{label:"Solar Capacity (kWp)",name:"solarCapacity"},{label:"Panel QTY",name:"panelQTY"},{label:"Battery Capacity (kWh)",name:"batteryCapacity"}].map(e=>{let{label:a,name:t}=e;return(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("span",{className:"text-gray-700",children:a}),(0,l.jsx)("input",{type:"text",name:t,value:f[t],onChange:D,className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300"})]},t)})}),(0,l.jsxs)("div",{className:"space-y-4 mt-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold",children:"Line Items"}),y.map((e,a)=>(0,l.jsxs)("div",{className:"flex gap-2 border p-4 rounded-lg items-center",children:[(0,l.jsx)("p",{className:"font-bold",children:a+1}),(0,l.jsxs)("label",{className:"block w-full",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Description"}),(0,l.jsx)("input",{type:"text",value:e.description,onChange:e=>v(a,"description",e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300",required:!0})]}),(0,l.jsxs)("label",{className:"block w-1/3 print-hidden",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Allocation"}),(0,l.jsxs)("select",{value:e.category,onChange:e=>v(a,"category",e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300",children:[(0,l.jsx)("option",{value:"shared",children:"Shared"}),(0,l.jsx)("option",{value:"solar",children:"Solar"}),(0,l.jsx)("option",{value:"battery",children:"Battery"})]})]}),(0,l.jsxs)("label",{className:"block w-1/3",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Quantity"}),(0,l.jsx)("input",{type:"number",value:e.qty,onChange:e=>v(a,"qty",e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300",required:!0})]}),(0,l.jsxs)("label",{className:"block w-1/2 print-hidden",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Unit Price"}),(0,l.jsx)("input",{type:"number",value:e.unit,onChange:e=>v(a,"unit",e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300",required:!0})]}),(0,l.jsxs)("label",{className:"block w-1/4 print-hidden",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Markup %"}),(0,l.jsx)("input",{type:"number",value:e.margin,onChange:e=>v(a,"margin",e.target.value),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300",required:!0})]}),(0,l.jsxs)("label",{className:"block w-1/2",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"Total"}),(0,l.jsx)("input",{readOnly:!0,value:Number(e.total).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),className:"mt-1 w-full px-4 py-2 bg-gray-100 rounded-md border-gray-300"})]}),(0,l.jsx)("button",{type:"button",onClick:()=>w(a),className:"mt-2 text-red-600 print-hidden",children:(0,l.jsx)(i.b6i,{size:25})})]},a)),(0,l.jsx)("button",{type:"button",onClick:()=>N(e=>[...e,{description:"",qty:"",unit:"",margin:"0",total:"0",category:"shared"}]),className:"bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-full print-hidden",children:"Add Line Item"})]}),(0,l.jsxs)("div",{className:"text-right font-bold text-xl",children:["Overall Total: R ",q.toFixed(2)]}),(0,l.jsxs)("div",{className:"text-right font-bold text-md",children:["Total Profit: R ",S.toFixed(2)]}),(0,l.jsxs)("div",{className:"text-right font-bold text-md",children:["Profit Margin: ",k.toFixed(2),"%"]}),(0,l.jsx)("button",{type:"submit",className:"mt-8 bg-[#4c7380] hover:bg-[#FFA07A] text-white font-bold py-2 px-4 rounded-full print-hidden",children:"Save Changes"})]})]}),(0,l.jsx)("button",{onClick:()=>e.push("/"),className:"mt-8 bg-[#4c7380] hover:bg-[#FFA07A] text-white font-bold py-2 px-4 rounded-full print-hidden",children:"Return Home"})]})}},3843:(e,a,t)=>{"use strict";t.d(a,{db:()=>n});var l=t(3915),s=t(5317);let r=(0,l.Wp)({apiKey:"AIzaSyDKxm2rzvjgsxfg1vJ6ZgzPJRPfY3R7HR4",authDomain:"phoenix-energy-firebase.firebaseapp.com",projectId:"phoenix-energy-firebase",storageBucket:"phoenix-energy-firebase.firebasestorage.app",messagingSenderId:"82665667347",appId:"1:82665667347:web:a6dab9227aa655573638e6",measurementId:"G-1CQS4L7V4Y"}),n=(0,s.aU)(r)},5228:(e,a,t)=>{Promise.resolve().then(t.bind(t,435))}},e=>{var a=a=>e(e.s=a);e.O(0,[992,479,399,935,441,684,358],()=>a(5228)),_N_E=e.O()}]);